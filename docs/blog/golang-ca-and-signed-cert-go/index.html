<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Shane Utt" />
    <meta name="description" content="My Programming Blog">
    <link rel="shortcut icon" type="image/x-icon" href="https://shaneutt.com/img/favicon.ico">
    <title>Golang - Creating a Certificate Authority &#43; Signing Certificates in Go</title>
    <meta name="generator" content="Hugo 0.74.3" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://shaneutt.com/css/main.css" /><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/tomorrow.min.css">
    
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old" />
    
    <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->

    
  </head>

  <body>
    <div id="wrap">

      
      <nav class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="https://shaneutt.com/"><i class="fa fa-home"></i></a>
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
        <li><a href="/blog/">BLOG</a></li>
        
      
      </ul>
    </div>
  </div>
</nav>

      
      <div class="container">
        <div class="blog-post">
          <h3>
            <strong><a href="https://shaneutt.com/blog/golang-ca-and-signed-cert-go/">Golang - Creating a Certificate Authority &#43; Signing Certificates in Go</a></strong>
          </h3>
        </div>
        <div class="blog-title">
          <h4>
          January 19, 2019
            &nbsp;&nbsp;
            
            <span class="label label-success">golang</span>
            
            <span class="label label-success">tls</span>
            
            <span class="label label-success">ssl</span>
            
          </h4>
        </div>
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="blogpost">
              <h1 id="creating-a-certificate-authority--signing-certificates-in-go">Creating a Certificate Authority + Signing Certificates in Go</h1>
<p>In this post I&rsquo;m going to describe how to create a <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA Certificate</a> and demonstrate signing certificates with that CA entirely in <a href="https://golang.org/">Golang</a>. For demonstration purposes, we&rsquo;ll use an <a href="https://godoc.org/net/http/httptest#Server">httptest</a> Server to deploy our cert, and an <a href="https://godoc.org/net/http#Client">net/http</a> Client to communicate with the server.</p>
<h1 id="requirements">Requirements</h1>
<ul>
<li><a href="https://golang.org/dl/">Golang v1.11.4+</a></li>
</ul>
<h1 id="packages-used">Packages Used</h1>
<p>In this demo we&rsquo;re going to make use of the following Go packages available in the Golang <a href="https://golang.org/pkg/#stdlib">standard library</a>:</p>
<ul>
<li><a href="https://godoc.org/bytes">bytes</a></li>
<li><a href="https://godoc.org/crypto/rand">crypto/rand</a></li>
<li><a href="https://godoc.org/crypto/rsa">crypto/rsa</a></li>
<li><a href="https://godoc.org/crypto/tls">crypto/tls</a></li>
<li><a href="https://godoc.org/crypto/x509">crypto/x509</a></li>
<li><a href="https://godoc.org/crypto/x509/pkix">crypto/x509/pkix</a></li>
<li><a href="https://godoc.org/encoding/pem">encoding/pem</a></li>
<li><a href="https://godoc.org/fmt">fmt</a></li>
<li><a href="https://godoc.org/io/ioutil">io/ioutil</a></li>
<li><a href="https://godoc.org/math/big">math/big</a></li>
<li><a href="https://godoc.org/net">net</a></li>
<li><a href="https://godoc.org/net/http">net/http</a></li>
<li><a href="https://godoc.org/net/http/httptest">net/http/httptest</a></li>
<li><a href="https://godoc.org/strings">strings</a></li>
<li><a href="https://godoc.org/time">time</a></li>
</ul>
<h1 id="creating-a-certificate-authority">Creating a Certificate Authority</h1>
<p>First we&rsquo;ll start off by creating our CA certificate. This is what we&rsquo;ll use to sign other certificates that we create:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">ca</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">Certificate</span>{
	<span style="color:#a6e22e">SerialNumber</span>: <span style="color:#a6e22e">big</span>.<span style="color:#a6e22e">NewInt</span>(<span style="color:#ae81ff">2019</span>),
	<span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">pkix</span>.<span style="color:#a6e22e">Name</span>{
		<span style="color:#a6e22e">Organization</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Company, INC.&#34;</span>},
		<span style="color:#a6e22e">Country</span>:       []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;US&#34;</span>},
		<span style="color:#a6e22e">Province</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;&#34;</span>},
		<span style="color:#a6e22e">Locality</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;San Francisco&#34;</span>},
		<span style="color:#a6e22e">StreetAddress</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Golden Gate Bridge&#34;</span>},
		<span style="color:#a6e22e">PostalCode</span>:    []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;94016&#34;</span>},
	},
	<span style="color:#a6e22e">NotBefore</span>:             <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
	<span style="color:#a6e22e">NotAfter</span>:              <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">AddDate</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>),
	<span style="color:#a6e22e">IsCA</span>:                  <span style="color:#66d9ef">true</span>,
	<span style="color:#a6e22e">ExtKeyUsage</span>:           []<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsage</span>{<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageClientAuth</span>, <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageServerAuth</span>},
	<span style="color:#a6e22e">KeyUsage</span>:              <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">KeyUsageDigitalSignature</span> | <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">KeyUsageCertSign</span>,
	<span style="color:#a6e22e">BasicConstraintsValid</span>: <span style="color:#66d9ef">true</span>,
}
</code></pre></div><p>The <code>IsCA</code> field set to <code>true</code> will indicate that this is our CA certificate. From here, we need to generate a public and private key for the certificate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">caPrivKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">GenerateKey</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#ae81ff">4096</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
}
</code></pre></div><p>And then we&rsquo;ll generate the certificate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">caBytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">CreateCertificate</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">ca</span>, <span style="color:#a6e22e">ca</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">caPrivKey</span>.<span style="color:#a6e22e">PublicKey</span>, <span style="color:#a6e22e">caPrivKey</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
}
</code></pre></div><p>Now in <code>caBytes</code> we have our generated certificate, which we can PEM encode for later use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">caPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">caPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
	<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;CERTIFICATE&#34;</span>,
	<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">caBytes</span>,
})

<span style="color:#a6e22e">caPrivKeyPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">caPrivKeyPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
	<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;RSA PRIVATE KEY&#34;</span>,
	<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKCS1PrivateKey</span>(<span style="color:#a6e22e">caPrivKey</span>),
})
</code></pre></div><p>Now we&rsquo;ve got our CA created and we&rsquo;re ready to sign certificates.</p>
<h1 id="creating-a-certificate">Creating a Certificate</h1>
<p>Creating the certificate we&rsquo;ll use for our HTTP server is similar to how we generated the CA, but with some changes to <code>x509.Certificate</code> fields:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">cert</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">Certificate</span>{
	<span style="color:#a6e22e">SerialNumber</span>: <span style="color:#a6e22e">big</span>.<span style="color:#a6e22e">NewInt</span>(<span style="color:#ae81ff">1658</span>),
	<span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">pkix</span>.<span style="color:#a6e22e">Name</span>{
		<span style="color:#a6e22e">Organization</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Company, INC.&#34;</span>},
		<span style="color:#a6e22e">Country</span>:       []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;US&#34;</span>},
		<span style="color:#a6e22e">Province</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;&#34;</span>},
		<span style="color:#a6e22e">Locality</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;San Francisco&#34;</span>},
		<span style="color:#a6e22e">StreetAddress</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Golden Gate Bridge&#34;</span>},
		<span style="color:#a6e22e">PostalCode</span>:    []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;94016&#34;</span>},
	},
	<span style="color:#a6e22e">IPAddresses</span>:  []<span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">IP</span>{<span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">IPv4</span>(<span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">IPv6loopback</span>},
	<span style="color:#a6e22e">NotBefore</span>:    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
	<span style="color:#a6e22e">NotAfter</span>:     <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">AddDate</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>),
	<span style="color:#a6e22e">SubjectKeyId</span>: []<span style="color:#66d9ef">byte</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>},
	<span style="color:#a6e22e">ExtKeyUsage</span>:  []<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsage</span>{<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageClientAuth</span>, <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageServerAuth</span>},
	<span style="color:#a6e22e">KeyUsage</span>:     <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">KeyUsageDigitalSignature</span>,
}
</code></pre></div><p>Note that in this certificate we&rsquo;ve specifically added <code>IPAddresses:  []net.IP{net.IPv4(127, 0, 0, 1), net.IPv6loopback},</code>, as we want this certificate to be valid at <code>localhost</code>.</p>
<p>Create a private and public key for the certificate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">certPrivKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">GenerateKey</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#ae81ff">4096</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
}
</code></pre></div><h1 id="signing-the-certificate-with-the-ca">Signing the Certificate with the CA</h1>
<p>Now we&rsquo;ll create the certificate and sign it with our CA:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">certBytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">CreateCertificate</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">cert</span>, <span style="color:#a6e22e">ca</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">certPrivKey</span>.<span style="color:#a6e22e">PublicKey</span>, <span style="color:#a6e22e">caPrivKey</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
}
</code></pre></div><p>And PEM encode the certificate and private key:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">certPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">certPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
	<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;CERTIFICATE&#34;</span>,
	<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">certBytes</span>,
})

<span style="color:#a6e22e">certPrivKeyPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">certPrivKeyPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
	<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;RSA PRIVATE KEY&#34;</span>,
	<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKCS1PrivateKey</span>(<span style="color:#a6e22e">certPrivKey</span>),
})
</code></pre></div><p>Now let&rsquo;s create the server and client <code>tls.Config</code> we will use for testing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">serverCert</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">X509KeyPair</span>(<span style="color:#a6e22e">certPEM</span>.<span style="color:#a6e22e">Bytes</span>(), <span style="color:#a6e22e">certPrivKeyPEM</span>.<span style="color:#a6e22e">Bytes</span>())
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
}

<span style="color:#a6e22e">serverTLSConf</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>{
	<span style="color:#a6e22e">Certificates</span>: []<span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Certificate</span>{<span style="color:#a6e22e">serverCert</span>},
}

<span style="color:#a6e22e">certpool</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">NewCertPool</span>()
<span style="color:#a6e22e">certpool</span>.<span style="color:#a6e22e">AppendCertsFromPEM</span>(<span style="color:#a6e22e">caPEM</span>.<span style="color:#a6e22e">Bytes</span>())
<span style="color:#a6e22e">clientTLSConf</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>{
	<span style="color:#a6e22e">RootCAs</span>: <span style="color:#a6e22e">certpool</span>,
}
</code></pre></div><h1 id="using-our-certificate-in-an-httptestserver">Using our Certificate in an httptest.Server</h1>
<p>Now we have everything we need to start our server using our new certificate signed by our CA, and for our client to trust that server.</p>
<p>First we&rsquo;ll configure and start the <code>httptest.Server</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">server</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">httptest</span>.<span style="color:#a6e22e">NewUnstartedServer</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandlerFunc</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;success!&#34;</span>)
}))
<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">TLS</span> = <span style="color:#a6e22e">serverTLSConf</span>
<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">StartTLS</span>()
<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Close</span>()
</code></pre></div><p>This will response with HTTP <code>200 OK</code> and a body containing <code>success!</code>. We can now set up the client to trust the CA, and send a request to the server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">transport</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Transport</span>{
	<span style="color:#a6e22e">TLSClientConfig</span>: <span style="color:#a6e22e">clientTLSConf</span>,
}
<span style="color:#a6e22e">http</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Client</span>{
	<span style="color:#a6e22e">Transport</span>: <span style="color:#a6e22e">transport</span>,
}
<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">URL</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	panic(<span style="color:#a6e22e">err</span>)
}
</code></pre></div><p>If no errors occurred, we now have our <code>success!</code> response from the server, and can verify it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">respBodyBytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	panic(<span style="color:#a6e22e">err</span>)
}
<span style="color:#a6e22e">body</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(string(<span style="color:#a6e22e">respBodyBytes</span>[:]))
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">body</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;success!&#34;</span> {
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">body</span>)
} <span style="color:#66d9ef">else</span> {
	panic(<span style="color:#e6db74">&#34;not successful!&#34;</span>)
}
</code></pre></div><h1 id="bringing-it-all-together">Bringing It All Together</h1>
<p>Here&rsquo;s a program that brings all the pieces together:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bytes&#34;</span>
	<span style="color:#e6db74">&#34;crypto/rand&#34;</span>
	<span style="color:#e6db74">&#34;crypto/rsa&#34;</span>
	<span style="color:#e6db74">&#34;crypto/tls&#34;</span>
	<span style="color:#e6db74">&#34;crypto/x509&#34;</span>
	<span style="color:#e6db74">&#34;crypto/x509/pkix&#34;</span>
	<span style="color:#e6db74">&#34;encoding/pem&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;io/ioutil&#34;</span>
	<span style="color:#e6db74">&#34;math/big&#34;</span>
	<span style="color:#e6db74">&#34;net&#34;</span>
	<span style="color:#e6db74">&#34;net/http&#34;</span>
	<span style="color:#e6db74">&#34;net/http/httptest&#34;</span>
	<span style="color:#e6db74">&#34;strings&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#75715e">// get our ca and server certificate
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">serverTLSConf</span>, <span style="color:#a6e22e">clientTLSConf</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">certsetup</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// set up the httptest.Server using our certificate signed by our CA
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">server</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">httptest</span>.<span style="color:#a6e22e">NewUnstartedServer</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandlerFunc</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;success!&#34;</span>)
	}))
	<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">TLS</span> = <span style="color:#a6e22e">serverTLSConf</span>
	<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">StartTLS</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#75715e">// communicate with the server using an http.Client configured to trust our CA
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">transport</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Transport</span>{
		<span style="color:#a6e22e">TLSClientConfig</span>: <span style="color:#a6e22e">clientTLSConf</span>,
	}
	<span style="color:#a6e22e">http</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Client</span>{
		<span style="color:#a6e22e">Transport</span>: <span style="color:#a6e22e">transport</span>,
	}
	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">URL</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">// verify the response
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">respBodyBytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">body</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(string(<span style="color:#a6e22e">respBodyBytes</span>[:]))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">body</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;success!&#34;</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">body</span>)
	} <span style="color:#66d9ef">else</span> {
		panic(<span style="color:#e6db74">&#34;not successful!&#34;</span>)
	}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">certsetup</span>() (<span style="color:#a6e22e">serverTLSConf</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>, <span style="color:#a6e22e">clientTLSConf</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
	<span style="color:#75715e">// set up our CA certificate
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ca</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">Certificate</span>{
		<span style="color:#a6e22e">SerialNumber</span>: <span style="color:#a6e22e">big</span>.<span style="color:#a6e22e">NewInt</span>(<span style="color:#ae81ff">2019</span>),
		<span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">pkix</span>.<span style="color:#a6e22e">Name</span>{
			<span style="color:#a6e22e">Organization</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Company, INC.&#34;</span>},
			<span style="color:#a6e22e">Country</span>:       []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;US&#34;</span>},
			<span style="color:#a6e22e">Province</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;&#34;</span>},
			<span style="color:#a6e22e">Locality</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;San Francisco&#34;</span>},
			<span style="color:#a6e22e">StreetAddress</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Golden Gate Bridge&#34;</span>},
			<span style="color:#a6e22e">PostalCode</span>:    []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;94016&#34;</span>},
		},
		<span style="color:#a6e22e">NotBefore</span>:             <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
		<span style="color:#a6e22e">NotAfter</span>:              <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">AddDate</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>),
		<span style="color:#a6e22e">IsCA</span>:                  <span style="color:#66d9ef">true</span>,
		<span style="color:#a6e22e">ExtKeyUsage</span>:           []<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsage</span>{<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageClientAuth</span>, <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageServerAuth</span>},
		<span style="color:#a6e22e">KeyUsage</span>:              <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">KeyUsageDigitalSignature</span> | <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">KeyUsageCertSign</span>,
		<span style="color:#a6e22e">BasicConstraintsValid</span>: <span style="color:#66d9ef">true</span>,
	}

	<span style="color:#75715e">// create our private and public key
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">caPrivKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">GenerateKey</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#ae81ff">4096</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#75715e">// create the CA
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">caBytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">CreateCertificate</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">ca</span>, <span style="color:#a6e22e">ca</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">caPrivKey</span>.<span style="color:#a6e22e">PublicKey</span>, <span style="color:#a6e22e">caPrivKey</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#75715e">// pem encode
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">caPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
	<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">caPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;CERTIFICATE&#34;</span>,
		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">caBytes</span>,
	})

	<span style="color:#a6e22e">caPrivKeyPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
	<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">caPrivKeyPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;RSA PRIVATE KEY&#34;</span>,
		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKCS1PrivateKey</span>(<span style="color:#a6e22e">caPrivKey</span>),
	})

	<span style="color:#75715e">// set up our server certificate
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">cert</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">Certificate</span>{
		<span style="color:#a6e22e">SerialNumber</span>: <span style="color:#a6e22e">big</span>.<span style="color:#a6e22e">NewInt</span>(<span style="color:#ae81ff">2019</span>),
		<span style="color:#a6e22e">Subject</span>: <span style="color:#a6e22e">pkix</span>.<span style="color:#a6e22e">Name</span>{
			<span style="color:#a6e22e">Organization</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Company, INC.&#34;</span>},
			<span style="color:#a6e22e">Country</span>:       []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;US&#34;</span>},
			<span style="color:#a6e22e">Province</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;&#34;</span>},
			<span style="color:#a6e22e">Locality</span>:      []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;San Francisco&#34;</span>},
			<span style="color:#a6e22e">StreetAddress</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;Golden Gate Bridge&#34;</span>},
			<span style="color:#a6e22e">PostalCode</span>:    []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;94016&#34;</span>},
		},
		<span style="color:#a6e22e">IPAddresses</span>:  []<span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">IP</span>{<span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">IPv4</span>(<span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">IPv6loopback</span>},
		<span style="color:#a6e22e">NotBefore</span>:    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
		<span style="color:#a6e22e">NotAfter</span>:     <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">AddDate</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>),
		<span style="color:#a6e22e">SubjectKeyId</span>: []<span style="color:#66d9ef">byte</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>},
		<span style="color:#a6e22e">ExtKeyUsage</span>:  []<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsage</span>{<span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageClientAuth</span>, <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ExtKeyUsageServerAuth</span>},
		<span style="color:#a6e22e">KeyUsage</span>:     <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">KeyUsageDigitalSignature</span>,
	}

	<span style="color:#a6e22e">certPrivKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">GenerateKey</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#ae81ff">4096</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">certBytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">CreateCertificate</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">cert</span>, <span style="color:#a6e22e">ca</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">certPrivKey</span>.<span style="color:#a6e22e">PublicKey</span>, <span style="color:#a6e22e">caPrivKey</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">certPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
	<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">certPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;CERTIFICATE&#34;</span>,
		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">certBytes</span>,
	})

	<span style="color:#a6e22e">certPrivKeyPEM</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>)
	<span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">certPrivKeyPEM</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;RSA PRIVATE KEY&#34;</span>,
		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKCS1PrivateKey</span>(<span style="color:#a6e22e">certPrivKey</span>),
	})

	<span style="color:#a6e22e">serverCert</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">X509KeyPair</span>(<span style="color:#a6e22e">certPEM</span>.<span style="color:#a6e22e">Bytes</span>(), <span style="color:#a6e22e">certPrivKeyPEM</span>.<span style="color:#a6e22e">Bytes</span>())
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">serverTLSConf</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>{
		<span style="color:#a6e22e">Certificates</span>: []<span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Certificate</span>{<span style="color:#a6e22e">serverCert</span>},
	}

	<span style="color:#a6e22e">certpool</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">NewCertPool</span>()
	<span style="color:#a6e22e">certpool</span>.<span style="color:#a6e22e">AppendCertsFromPEM</span>(<span style="color:#a6e22e">caPEM</span>.<span style="color:#a6e22e">Bytes</span>())
	<span style="color:#a6e22e">clientTLSConf</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tls</span>.<span style="color:#a6e22e">Config</span>{
		<span style="color:#a6e22e">RootCAs</span>: <span style="color:#a6e22e">certpool</span>,
	}

	<span style="color:#66d9ef">return</span>
}
</code></pre></div><p>Which is also available <a href="https://gist.github.com/shaneutt/5e1995295cff6721c89a71d13a71c251">on Github</a>.</p>
<p>Happy coding!</p>

              <hr>
              <div class="related-posts">
                <h5>Related Posts</h5>
                
              </div>
            </div>
          </div>
          <hr>
        <div class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">

    (function() {
      
      
      if (window.location.hostname == "localhost")
        return;

      var disqus_shortname = '';
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        </div>
      </div>
      
    </div>

    
    <footer>
  <div id="footer">
    <div class="container">
      <p class="text-muted">&copy; All rights reserved.</p>
    </div>
  </div>
</footer>
<div class="footer"></div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://shaneutt.com/js/docs.min.js"></script>
<script src="https://shaneutt.com/js/main.js"></script>

<script src="https://shaneutt.com/js/ie10-viewport-bug-workaround.js"></script><!-- Syntax highlighting -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>
</html>
